<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Trino dynamic filtering（动态过滤） | 我想问问天的博客</title><meta name="author" content="我想问问天"><meta name="copyright" content="我想问问天"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Trino dynamic filtering（动态过滤） 前言：最近看了下trino的文档，看到里面有提到一个概念，叫dynamic filtering 动态过滤。就想了解下它是怎么一个动态法呢？看了trino的官方文档和一些其他引擎其他相关的动态过滤的资料，写一点自己的理解。 介绍：概念：Dynamic filtering optimizations significantly improv">
<meta property="og:type" content="article">
<meta property="og:title" content="Trino dynamic filtering（动态过滤）">
<meta property="og:url" content="http://example.com/2023/12/31/algorithmAndDataStructures/leetcode/Trino%20dynamic%20filtering%EF%BC%88%E5%8A%A8%E6%80%81%E8%BF%87%E6%BB%A4%EF%BC%89/index.html">
<meta property="og:site_name" content="我想问问天的博客">
<meta property="og:description" content="Trino dynamic filtering（动态过滤） 前言：最近看了下trino的文档，看到里面有提到一个概念，叫dynamic filtering 动态过滤。就想了解下它是怎么一个动态法呢？看了trino的官方文档和一些其他引擎其他相关的动态过滤的资料，写一点自己的理解。 介绍：概念：Dynamic filtering optimizations significantly improv">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/avatar.jpg">
<meta property="article:published_time" content="2023-12-31T13:36:04.000Z">
<meta property="article:modified_time" content="2024-08-15T14:35:58.000Z">
<meta property="article:author" content="我想问问天">
<meta property="article:tag" content="leetcode">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/12/31/algorithmAndDataStructures/leetcode/Trino%20dynamic%20filtering%EF%BC%88%E5%8A%A8%E6%80%81%E8%BF%87%E6%BB%A4%EF%BC%89/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-9356781636799135',
  enable_page_level_ads: 'true'
});</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-K8M4PR0JSN"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-K8M4PR0JSN');
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 我想问问天","link":"链接: ","source":"来源: 我想问问天的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Trino dynamic filtering（动态过滤）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-15 22:35:58'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">99</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">45</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="我想问问天的博客"><span class="site-name">我想问问天的博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Trino dynamic filtering（动态过滤）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-12-31T13:36:04.000Z" title="发表于 2023-12-31 21:36:04">2023-12-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-15T14:35:58.000Z" title="更新于 2024-08-15 22:35:58">2024-08-15</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Trino dynamic filtering（动态过滤）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p> Trino dynamic filtering（动态过滤）</p>
<h1 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h1><p>最近看了下trino的文档，看到里面有提到一个概念，叫dynamic filtering 动态过滤。就想了解下它是怎么一个动态法呢？看了trino的官方文档和一些其他引擎其他相关的动态过滤的资料，写一点自己的理解。</p>
<h1 id="介绍："><a href="#介绍：" class="headerlink" title="介绍："></a>介绍：</h1><h2 id="概念："><a href="#概念：" class="headerlink" title="概念："></a>概念：</h2><p>Dynamic filtering optimizations significantly improve the performance of queries with selective joins by avoiding reading of data that would be filtered by join condition.</p>
<p>这个是官方文档描述动态过滤的第一句话，翻译过来就是动态过滤优化通过减少了join中读取了不必要的数据，显著的提高了查询性能。我们就可以知道动态过滤作用是提高查询性能的，然后通过它自己的一系列优化，能让sql少去读取一些不会用到的数据。数据量减少，传输和计算就意味着减少，那么性能自然就提高了，这也是sql优化的核心宗旨，减少用不到的数据量。</p>
<h2 id="执行过程："><a href="#执行过程：" class="headerlink" title="执行过程："></a>执行过程：</h2><p>我们再来看下它是怎么个动态法? 官网也提供了一个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT count(*) FROM store_sales JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk WHERE d_following_holiday=’Y’ AND d_year = 2000;</span><br></pre></td></tr></table></figure>

<p>看这个sql，我们知道是store_sales（就简称为销售表把），join了另外一张date_dim（日期表），并且对日期表有两个谓词表达式，这里官网并没有说d_following_holiday，d_year是日期表的字段，但是能看出来这两个是对时间进行筛选的，而且是d_大概率是日期维度表的。如果没有动态过滤的情况下，sql的谓词会被推送到日期表，但是销售表会被全表扫描，官网也说了销售表是事实表，那么一般情况下，事实表的数据量是很大的，至少比维度表大很多，因为最后sql不会用销售表的全部数据，所以这里其实会有很多计算和数据传输被浪费掉。</p>
<p>如果启用了动态过滤，那么trino会从join右侧的维度表里面收集连接条件，也就是store_sales.ss_sold_date_sk &#x3D; date_dim.d_date_sk的数据，coordinator会将连接条件就生成运行时的谓词，可能像是store_sales.ss_sold_date_sk in (xxxx)之类的，推送给各个执行的worker，这样每个worker执行传输计算的数据量就都会减少，性能就得到了提高。</p>
<h2 id="动态过滤开启-关闭："><a href="#动态过滤开启-关闭：" class="headerlink" title="动态过滤开启&#x2F;关闭："></a>动态过滤开启&#x2F;关闭：</h2><p>从coordinator到work的动态过滤是默认启用的。</p>
<p>可以通过将enable-coordinator-dynamic-filters-distribution 配置属性或会话属性enable_coordinator_dynamic_filters_distribution 设置为 false 来禁用它</p>
<h2 id="影响因素："><a href="#影响因素：" class="headerlink" title="影响因素："></a>影响因素：</h2><ul>
<li><p>Planner 支持 Trino 中给定连接操作的动态过滤。目前支持使用 &#x3D;、&lt;、&lt;&#x3D;、&gt;、&gt;&#x3D; 或 IS NOT DISTINCT FROM 连接条件进行内连接和右连接，并支持使用 IN 条件的半连接。</p>
</li>
<li><p>连接器支持利用在运行时推入表扫描的动态过滤器。例如，Hive 连接器可以将动态过滤器推送到 ORC 和 Parquet 读取器中，以执行条带或行组修剪。</p>
</li>
<li><p>connector支持在拆分枚举阶段使用动态过滤器</p>
</li>
<li><p>join右表的数据量</p>
</li>
</ul>
<h2 id="查看动态过滤的方式"><a href="#查看动态过滤的方式" class="headerlink" title="查看动态过滤的方式"></a>查看动态过滤的方式</h2><p>  1.官网举了一个例子，用来查看指定的sql是否有添加动态过滤器，sql如下：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN</span><br><span class="line">SELECT count(*)</span><br><span class="line">FROM store_sales</span><br><span class="line">JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk</span><br><span class="line">WHERE d_following_holiday=&#x27;Y&#x27; AND d_year = 2000;</span><br></pre></td></tr></table></figure>

<p>  返回的结果：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Fragment 1 [SOURCE]</span><br><span class="line">    Output layout: [count_3]</span><br><span class="line">    Output partitioning: SINGLE []</span><br><span class="line">    Aggregate(PARTIAL)</span><br><span class="line">    │   Layout: [count_3:bigint]</span><br><span class="line">    │   count_3 := count(*)</span><br><span class="line">    └─ InnerJoin[(&quot;&quot;ss_sold_date_sk&quot;&quot; = &quot;&quot;d_date_sk&quot;&quot;)][$hashvalue, $hashvalue_4]</span><br><span class="line">       │   Layout: []</span><br><span class="line">       │   Estimates: &#123;rows: 0 (0B), cpu: 0, memory: 0B, network: 0B&#125;</span><br><span class="line">       │   Distribution: REPLICATED</span><br><span class="line">       │   dynamicFilterAssignments = &#123;d_date_sk -&gt; #df_370&#125;</span><br><span class="line">       ├─ ScanFilterProject[table = hive:default:store_sales, grouped = false, filterPredicate = true, dynamicFilters = &#123;&quot;&quot;ss_sold_date_sk&quot;&quot; = #df_370&#125;]</span><br><span class="line">       │      Layout: [ss_sold_date_sk:bigint, $hashvalue:bigint]</span><br><span class="line">       │      Estimates: &#123;rows: 0 (0B), cpu: 0, memory: 0B, network: 0B&#125;/&#123;rows: 0 (0B), cpu: 0, memory: 0B, network: 0B&#125;/&#123;rows: 0 (0B), cpu: 0, memory: 0B, network: 0B&#125;</span><br><span class="line">       │      $hashvalue := combine_hash(bigint &#x27;0&#x27;, COALESCE(&quot;&quot;$operator$hash_code&quot;&quot;(&quot;&quot;ss_sold_date_sk&quot;&quot;), 0))</span><br><span class="line">       │      ss_sold_date_sk := ss_sold_date_sk:bigint:REGULAR</span><br><span class="line">       └─ LocalExchange[HASH][$hashvalue_4] (&quot;&quot;d_date_sk&quot;&quot;)</span><br><span class="line">          │   Layout: [d_date_sk:bigint, $hashvalue_4:bigint]</span><br><span class="line">          │   Estimates: &#123;rows: 0 (0B), cpu: 0, memory: 0B, network: 0B&#125;</span><br><span class="line">          └─ RemoteSource[2]</span><br><span class="line">                 Layout: [d_date_sk:bigint, $hashvalue_5:bigint]</span><br><span class="line"></span><br><span class="line">Fragment 2 [SOURCE]</span><br><span class="line">    Output layout: [d_date_sk, $hashvalue_6]</span><br><span class="line">    Output partitioning: BROADCAST []</span><br><span class="line">    ScanFilterProject[table = hive:default:date_dim, grouped = false, filterPredicate = ((&quot;&quot;d_following_holiday&quot;&quot; = CAST(&#x27;Y&#x27; AS char(1))) AND (&quot;&quot;d_year&quot;&quot; = 2000))]</span><br><span class="line">        Layout: [d_date_sk:bigint, $hashvalue_6:bigint]</span><br><span class="line">        Estimates: &#123;rows: 0 (0B), cpu: 0, memory: 0B, network: 0B&#125;/&#123;rows: 0 (0B), cpu: 0, memory: 0B, network: 0B&#125;/&#123;rows: 0 (0B), cpu: 0, memory: 0B, network: 0B&#125;</span><br><span class="line">        $hashvalue_6 := combine_hash(bigint &#x27;0&#x27;, COALESCE(&quot;&quot;$operator$hash_code&quot;&quot;(&quot;&quot;d_date_sk&quot;&quot;), 0))</span><br><span class="line">        d_following_holiday := d_following_holiday:char(1):REGULAR</span><br><span class="line">        d_date_sk := d_date_sk:bigint:REGULAR</span><br><span class="line">        d_year := d_year:int:REGULAR</span><br></pre></td></tr></table></figure>

<p>  可以看到Fragement1InnerJoin里面有一个dynamicFilterAssignments，这里就是说明使用了动态过滤，会将d_date_sk的谓词推送到连接器里面。</p>
<p>2.在webUI界面也可以看到对应动态过滤情况，在coordinator的queryStats里面，有一个dynamicFiltersStats的对象。就像下面展示的那样：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;dynamicFiltersStats&quot; : &#123;</span><br><span class="line">      &quot;dynamicFilterDomainStats&quot; : [ &#123;</span><br><span class="line">        &quot;dynamicFilterId&quot; : &quot;df_370&quot;,</span><br><span class="line">        &quot;simplifiedDomain&quot; : &quot;[ SortedRangeSet[type=bigint, ranges=3, &#123;[2451546], ..., [2451905]&#125;] ]&quot;,</span><br><span class="line">        &quot;collectionDuration&quot; : &quot;2.34s&quot;</span><br><span class="line">      &#125; ],</span><br><span class="line">      &quot;lazyDynamicFilters&quot; : 1,</span><br><span class="line">      &quot;replicatedDynamicFilters&quot; : 1,</span><br><span class="line">      &quot;totalDynamicFilters&quot; : 1,</span><br><span class="line">      &quot;dynamicFiltersCompleted&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.还可以通过查看该表扫描的统计信息来查看将动态过滤器下推到work节点上的表扫描中。 dynamicFilterSplitsProcessed 记录动态过滤器下推到表扫描后处理的拆分数量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;operatorType&quot; : &quot;ScanFilterAndProjectOperator&quot;,</span><br><span class="line">&quot;totalDrivers&quot; : 1,</span><br><span class="line">&quot;addInputCalls&quot; : 762,</span><br><span class="line">&quot;addInputWall&quot; : &quot;0.00ns&quot;,</span><br><span class="line">&quot;addInputCpu&quot; : &quot;0.00ns&quot;,</span><br><span class="line">&quot;physicalInputDataSize&quot; : &quot;0B&quot;,</span><br><span class="line">&quot;physicalInputPositions&quot; : 28800991,</span><br><span class="line">&quot;inputPositions&quot; : 28800991,</span><br><span class="line">&quot;dynamicFilterSplitsProcessed&quot; : 1,</span><br></pre></td></tr></table></figure>

<p>4.可以使用EXPLAIN ANALYZE来查看动态过滤信息，可以看到里面有个dynamicFilterAssignments的属性，跟上面说到的EXPLAIN方式差不多</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"> └─ InnerJoin[(&quot;ss_sold_date_sk&quot; = &quot;d_date_sk&quot;)][$hashvalue, $hashvalue_4]</span><br><span class="line">    │   Layout: []</span><br><span class="line">    │   Estimates: &#123;rows: 11859 (0B), cpu: 8.84M, memory: 3.19kB, network: 3.19kB&#125;</span><br><span class="line">    │   CPU: 78.00ms (30.00%), Scheduled: 295.00ms (47.05%), Output: 296 rows (0B)</span><br><span class="line">    │   Left (probe) Input avg.: 120527.00 rows, Input std.dev.: 0.00%</span><br><span class="line">    │   Right (build) Input avg.: 0.19 rows, Input std.dev.: 208.17%</span><br><span class="line">    │   Distribution: REPLICATED</span><br><span class="line">    │   dynamicFilterAssignments = &#123;d_date_sk -&gt; #df_370&#125;</span><br><span class="line">    ├─ ScanFilterProject[table = hive:default:store_sales, grouped = false, filterPredicate = true, dynamicFilters = &#123;&quot;ss_sold_date_sk&quot; = #df_370&#125;]</span><br><span class="line">    │      Layout: [ss_sold_date_sk:bigint, $hashvalue:bigint]</span><br><span class="line">    │      Estimates: &#123;rows: 120527 (2.03MB), cpu: 1017.64k, memory: 0B, network: 0B&#125;/&#123;rows: 120527 (2.03MB), cpu: 1.99M, memory: 0B, network: 0B&#125;/&#123;rows: 120527 (2.03MB), cpu: 4.02M, memory: 0B, network: 0B&#125;</span><br><span class="line">    │      CPU: 49.00ms (18.85%), Scheduled: 123.00ms (19.62%), Output: 120527 rows (2.07MB)</span><br><span class="line">    │      Input avg.: 120527.00 rows, Input std.dev.: 0.00%</span><br><span class="line">    │      $hashvalue := combine_hash(bigint &#x27;0&#x27;, COALESCE(&quot;$operator$hash_code&quot;(&quot;ss_sold_date_sk&quot;), 0))</span><br><span class="line">    │      ss_sold_date_sk := ss_sold_date_sk:bigint:REGULAR</span><br><span class="line">    │      Input: 120527 rows (1.03MB), Filtered: 0.00%</span><br><span class="line">    │      Dynamic filters:</span><br><span class="line">    │          - df_370, [ SortedRangeSet[type=bigint, ranges=3, &#123;[2451546], ..., [2451905]&#125;] ], collection time=2.34s</span><br><span class="line">    |</span><br><span class="line">...</span><br></pre></td></tr></table></figure>





<h2 id="局限性："><a href="#局限性：" class="headerlink" title="局限性："></a>局限性：</h2><ul>
<li><p>Min-max dynamic filter collection is not supported for <code>DOUBLE</code>, <code>REAL</code> and unorderable data types.</p>
</li>
<li><p>Dynamic filtering is not supported for <code>DOUBLE</code> and <code>REAL</code> data types when using <code>IS NOT DISTINCT FROM</code> predicate.</p>
</li>
<li><p>Dynamic filtering is supported when the join key contains a cast from the build key type to the probe key type. Dynamic filtering is also supported in limited scenarios when there is an implicit cast from the probe key type to the build key type. For example, dynamic filtering is supported when the build side key is of <code>DOUBLE</code> type and the probe side key is of <code>REAL</code> or <code>INTEGER</code> type.</p>
</li>
<li><p>DOUBLE、REAL 和不可排序数据类型不支持最小-最大动态过滤器集合。</p>
</li>
<li><p>使用 IS NOT DISTINCT FROM 谓词时，DOUBLE 和 REAL 数据类型不支持动态过滤。</p>
</li>
<li><p>当连接键包含从构建键类型到探测键类型的转换时，支持动态过滤。当存在从探测密钥类型到构建密钥类型的隐式转换时，在有限的情况下也支持动态过滤。例如，当构建侧密钥为 DOUBLE 类型且探测侧密钥为 REAL 或 INTEGER 类型时，支持动态过滤</p>
</li>
</ul>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://trino.io/docs/current/admin/dynamic-filtering.html">1.trino 动态过滤</a></p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/maxcompute/user-guide/dynamic-filtering">2.阿里云动态过滤器</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://www.wxwwt.site">我想问问天</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/12/31/algorithmAndDataStructures/leetcode/Trino%20dynamic%20filtering%EF%BC%88%E5%8A%A8%E6%80%81%E8%BF%87%E6%BB%A4%EF%BC%89/">http://example.com/2023/12/31/algorithmAndDataStructures/leetcode/Trino%20dynamic%20filtering%EF%BC%88%E5%8A%A8%E6%80%81%E8%BF%87%E6%BB%A4%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">我想问问天的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/leetcode/">leetcode</a></div><div class="post_share"><div class="social-share" data-image="/images/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/01/06/dataBase/SqlServerTimeStamp%E7%B1%BB%E5%9E%8B/" title="SqlServerTimeStamp类型"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SqlServerTimeStamp类型</div></div></a></div><div class="next-post pull-right"><a href="/2023/12/10/algorithmAndDataStructures/leetcode/%E5%89%8D%E7%BC%80%E5%92%8C+hash%E8%A1%A8/" title="前缀和+hash表"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">前缀和+hash表</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/11/05/algorithmAndDataStructures/leetcode/LeetCode-%E5%91%A8%E8%B5%9B-370Q4%EF%BC%88%E6%A0%91%E7%8A%B6DP%EF%BC%89/" title="LeetCode-周赛-370Q4（树状DP）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-05</div><div class="title">LeetCode-周赛-370Q4（树状DP）</div></div></a></div><div><a href="/2023/11/05/algorithmAndDataStructures/leetcode/leetcode-7022%E9%99%90%E5%88%B6%E6%9D%A1%E4%BB%B6%E4%B8%8B%E5%85%83%E7%B4%A0%E4%B9%8B%E9%97%B4%E7%9A%84%E6%9C%80%E5%B0%8F%E7%BB%9D%E5%AF%B9%E5%B7%AE/" title="leetcode-7022限制条件下元素之间的最小绝对差"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-05</div><div class="title">leetcode-7022限制条件下元素之间的最小绝对差</div></div></a></div><div><a href="/2023/11/05/algorithmAndDataStructures/leetcode/leetcode53_%E6%9C%80%E5%A4%A7%E5%AD%90%E5%BA%8F%E5%92%8C/" title="leetcode53_最大子序和"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-05</div><div class="title">leetcode53_最大子序和</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">我想问问天</div><div class="author-info__description">我想问问天的个人网站，用来记录我的技术文章，生活记录，读书笔记等，希望能给各位读者带来一点帮助或者快乐~</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">99</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">45</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wxwwt"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">前言：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">介绍：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%EF%BC%9A"><span class="toc-number">2.1.</span> <span class="toc-text">概念：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="toc-number">2.2.</span> <span class="toc-text">执行过程：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%BF%87%E6%BB%A4%E5%BC%80%E5%90%AF-%E5%85%B3%E9%97%AD%EF%BC%9A"><span class="toc-number">2.3.</span> <span class="toc-text">动态过滤开启&#x2F;关闭：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E5%9B%A0%E7%B4%A0%EF%BC%9A"><span class="toc-number">2.4.</span> <span class="toc-text">影响因素：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%8A%A8%E6%80%81%E8%BF%87%E6%BB%A4%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">2.5.</span> <span class="toc-text">查看动态过滤的方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%80%E9%99%90%E6%80%A7%EF%BC%9A"><span class="toc-number">2.6.</span> <span class="toc-text">局限性：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">3.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/04/ai/%E5%85%B3%E4%BA%8E%E5%89%AF%E4%B8%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%83%B3%E6%B3%95/" title="关于副业的一些想法">关于副业的一些想法</a><time datetime="2024-08-04T12:00:26.000Z" title="发表于 2024-08-04 20:00:26">2024-08-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/04/ai/%E5%BF%8D%E6%B3%95%EF%BC%9A%E5%A3%B0%E9%9F%B3%E5%85%8B%E9%9A%86%E4%B9%8B%E6%9C%AF-GPT-sovits/" title="忍法：声音克隆之术-GPT-sovits">忍法：声音克隆之术-GPT-sovits</a><time datetime="2024-08-04T09:42:18.000Z" title="发表于 2024-08-04 17:42:18">2024-08-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/05/ai/%E5%9F%BA%E4%BA%8ELangChain%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AAagent/" title="基于LangChain搭建一个agent">基于LangChain搭建一个agent</a><time datetime="2024-05-05T14:43:40.000Z" title="发表于 2024-05-05 22:43:40">2024-05-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/24/ai/LangChain-Chatchat%E7%9F%A5%E8%AF%86%E5%BA%93%E4%BD%BF%E7%94%A8/" title="LangChain-Chatchat知识库使用">LangChain-Chatchat知识库使用</a><time datetime="2024-03-24T13:05:23.000Z" title="发表于 2024-03-24 21:05:23">2024-03-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/11/ai/Langchain-Chatchat%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" title="Langchain-Chatchat安装使用">Langchain-Chatchat安装使用</a><time datetime="2024-03-11T14:57:19.000Z" title="发表于 2024-03-11 22:57:19">2024-03-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 我想问问天</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>